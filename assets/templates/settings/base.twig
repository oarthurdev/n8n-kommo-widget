<div id="kommo-settings" class="kommo-settings" style="display: none">
  {% if not active %}
    <div class="roydis-text--settings">
      {% if exception %}
        {{ exception }}
      {% else %}
        {{ langs.not_active }}
      {% endif %}
    </div>
  {% else %}
    <div class="kommo-text--settings">
      {{ langs.base }}
    </div>

    <form id="{{ prefix }}-settings__form">
      <h3 class="kommo-h3--settings">{{ langs.options.title }}</h3>
      <div class="kommo-text--settings">
        {{ langs.options.desc }}
      </div>

      <div class="kommo-settings__content">
        <!-- Webhook URL Configuration -->
        <div class="widget_settings_block__item_field widget_settings_block__item_field--input">
      <div class="widget_settings_block__item_field__title">
        {{ langs.webhook.title }}
      </div>
      <div class="widget_settings_block__item_field__input">
        {{ webhook }}
      </div>
      <div class="widget_settings_block__item_field__descr">
        {{ langs.webhook.desc }}
      </div>
    </div>

    <!-- API Key Configuration -->
    <div class="widget_settings_block__item_field widget_settings_block__item_field--input">
      <div class="widget_settings_block__item_field__title">
        {{ langs.openai_key.title }}
      </div>
      <div class="widget_settings_block__item_field__input">
        {{ openai_key }}
      </div>
      <div class="widget_settings_block__item_field__descr">
        {{ langs.openai_key.desc }}
      </div>
    </div>

    <!-- Agent Selection -->
    <div class="widget_settings_block__item_field widget_settings_block__item_field--select">
      <div class="widget_settings_block__item_field__title">
        {{ langs.agents.title }}
      </div>
      <div class="widget_settings_block__item_field__input">
        <div style="display: flex; gap: 10px; align-items: center;">
          {{ agents_select }}
          {{ load_agents_button }}
        </div>
      </div>
      <div class="widget_settings_block__item_field__descr">
        {{ langs.agents.desc }}
      </div>
    </div>

    <!-- Template Generation -->
    <div class="widget_settings_block__item_field widget_settings_block__item_field--button">
      <div class="widget_settings_block__item_field__title">
        {{ langs.template_generation.title }}
      </div>
      <div class="widget_settings_block__item_field__input">
        {{ generate_template_button }}
        <div id="kommo-n8n-template-result" class="kommo-test-result" style="display: none; margin-top: 10px;"></div>
        <div id="kommo-n8n-template-output" style="display: none; margin-top: 10px;">
          <textarea id="kommo-n8n-template-json" readonly style="width: 100%; height: 200px; font-family: monospace; font-size: 12px;"></textarea>
          <button id="kommo-n8n-copy-template" style="margin-top: 5px;">Copy Template</button>
        </div>
      </div>
      <div class="widget_settings_block__item_field__descr">
        {{ langs.template_generation.desc }}
      </div>
    </div>
      </div>
    </form>
  {% endif %}
</div>